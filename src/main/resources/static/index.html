<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Console and Chat Box</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }
        #console {
            background-color: #333;
            color: white;
            height: 300px;
            width: 100%;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
        }
        #chat-box {
            background-color: #fff;
            border: 1px solid #ccc;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #chat-box input, #chat-box button {
            padding: 10px;
            font-size: 16px;
            width: 100%;
        }
        .settingLabel {
            font-size: 11px;
        }
    </style>
</head>
<body>

<h2>Console</h2>
<div id="console">
    <p>Welcome to the test page.</p>
    <p>Type something in the chat box below! With a Chat Id </p>
</div>

<h2>Chat Box</h2>
<div id="chat-box">
    <label for="chatid"></label><input type="text" id="chatid" placeholder="Enter Chat ID" value="chatId1" />
    <label for="chatmodel">Choose a Model:</label>
    <select name="chatmodel" id="chatmodel">
        <option value="gpt-35-turbo">gpt-35-turbo</option>
        <option value="gpt-4-32k-0314">gpt-4-32k-0314</option>
        <option value="amazon.titan-tg1-large">amazon.titan-tg1-large</option>
        <option value="gemini-1.5-flash-002">gemini-1.5-flash-002</option>
    </select>
    <table>
        <tr>
            <td><label class="settingLabel" for="temperature">temperature (0.0 - 2.0):</label><input type="text" id="temperature" placeholder="temperature" value="1.0" /></td>
            <td><label class="settingLabel" for="top_p">top_p (0.0 - 1.0):</label><input type="text" id="top_p" placeholder="top_p" value="1.0"/></td>
            <td><label class="settingLabel" for="presence_penalty">presence_penalty (-2.0 - 2.0):</label><input type="text" id="presence_penalty" placeholder="presencePenalty" value="0.0"/></td>
            <td><label class="settingLabel" for="frequency_penalty">frequency_penalty (-2.0 - 2.0):</label><input type="text" id="frequency_penalty" placeholder="frequencyPenalty" value="0.0"/></td>
            <td><label class="settingLabel" for="max_tokens">max_tokens (1 - Integer Max):</label><input type="text" id="max_tokens" placeholder="maxTokens" value="256"/></td>
            <td><label class="settingLabel" for="results_per_prompt">results_per_prompt (1 - Integer Max):</label><input type="text" id="results_per_prompt" placeholder="resultsPerPrompt" value="1"/></td>
            <td><label class="settingLabel" for="best_of">best_of (1 - Integer Max):</label><input type="text" id="best_of" placeholder="bestOf" value="1"/></td>
        </tr>
    </table>
    <label for="message"></label><input type="text" id="message" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    // Function to send the message to the /chat endpoint
    function sendMessage() {
        var message = document.getElementById("message").value;
        var chatId = document.getElementById("chatid").value;
        var temperature = document.getElementById("temperature").value;
        var top_p = document.getElementById("top_p").value;
        var presence_penalty = document.getElementById("presence_penalty").value;
        var frequency_penalty = document.getElementById("frequency_penalty").value;
        var max_tokens = document.getElementById("max_tokens").value;
        var results_per_prompt = document.getElementById("results_per_prompt").value;
        var best_of = document.getElementById("best_of").value;
        var chatModel = document.getElementById("chatmodel").value;

        if (message && chatid) {
            var consoleDiv = document.getElementById("console");
            var p = document.createElement("p");
            var s = document.createElement("span");
            s.style.color='green';
            p.textContent = "Question : " + message ; // The response will be the formatted chat message
            s.textContent = "( Model : " + chatModel + ")";
            consoleDiv.appendChild(p);
            consoleDiv.appendChild(s);
            // Use fetch to call the REST API with chatid, input, and user
            fetch(`/chat?input=${encodeURIComponent(message)}&chatId=${encodeURIComponent(chatId)}&modelId=${encodeURIComponent(chatModel)}`,{
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ temperature: temperature,
                                           top_p: top_p,
                                           presence_penalty: presence_penalty,
                                           frequency_penalty: frequency_penalty,
                                           max_tokens: max_tokens,
                                           results_per_prompt: results_per_prompt,
                                           best_of: best_of
                                            }) // Send data in JSON format
                })
                .then(response => response.text())
                .then(data => {
                    // Append the message to the console
                    var consoleDiv = document.getElementById("console");
                    var p = document.createElement("p");
                    p.textContent = data.replace(/\\n/g," "); // The response will be the formatted chat message
                    consoleDiv.appendChild(p);
                    document.getElementById("message").value = ""; // Clear input field
                    consoleDiv.scrollTop = consoleDiv.scrollHeight; // Auto scroll to bottom
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        } else {
            alert('Please provide both Chat ID and Message!');
        }
    }
</script>

</body>
</html>
